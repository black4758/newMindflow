http {
    include       mime.types;        # Set MIME types based on file extensions
    default_type  application/octet-stream;  # Default file type if unknown

    sendfile        on;  # Enable optimized file transfer

    # Upstream configuration for the React frontend server
    upstream frontend {
        server react_container:80;  # Connect to the React container on port 80
    }

    # Upstream configuration for the Spring Boot backend server
    upstream backend {
        server springboot_container:8453;  # Connect to the Spring Boot container on port 8453
    }

    # Server block to handle HTTP requests
    server {
        listen 80;  # Port to listen for incoming HTTP requests (default HTTP port)

        # Handling requests for the frontend
        location / {
            proxy_pass http://frontend;  # Forward all root requests to the React frontend
            proxy_set_header Host $host;  # Preserve the original Host header
            proxy_set_header X-Real-IP $remote_addr;  # Forward the client's real IP address
        }

        # Handling API requests (proxy to the backend)
        location /api/ {
            proxy_pass http://backend;  # Forward requests starting with /api/ to the Spring Boot backend
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }
}